# 笔记总结工作流需求文档

## 介绍

本功能旨在通过多份相关笔记的智能总结来补充完善用户的笔记内容。系统将接收多份文本笔记，通过分析、总结、置信度评估等步骤，生成高质量的综合总结，帮助用户更好地整理和完善知识点。

## 需求

### 需求 1: 多笔记输入处理

**用户故事:** 作为用户，我希望能够提交多份相关的文本笔记，以便系统能够对它们进行统一处理和分析。

#### 验收标准

1. 当用户通过API提交多份笔记时，系统应当能够接收并存储这些文本内容
2. 系统应当支持配置最小笔记数量阈值（可配置变量）
3. 当笔记数量少于设定阈值时，系统应当只进行单次总结处理
4. 当笔记数量达到阈值时，系统应当启用完整的多笔记总结工作流
5. 当单份笔记内容为空时，系统应当过滤掉该笔记
6. 系统应当为每次处理请求生成唯一的任务ID

### 需求 2: 单笔记知识点总结生成

**用户故事:** 作为用户，我希望系统能够为每份笔记生成分知识点的总结，以便后续进行综合分析。

#### 验收标准

1. 当系统接收到笔记后，应当为每份笔记生成结构化的知识点总结
2. 每份总结应当包含主要知识点、关键概念和核心内容
3. 总结应当保持原笔记的核心信息不丢失
4. 系统应当能够处理中文文本内容

### 需求 3: 综合总结生成

**用户故事:** 作为用户，我希望系统能够将所有单笔记总结放入同一上下文中再次总结，以便获得更全面的知识整合。

#### 验收标准

1. 当所有单笔记总结完成后，系统应当将它们合并到同一上下文中
2. 系统应当基于合并的内容生成一份综合总结
3. 综合总结应当体现各笔记间的关联性和互补性
4. 综合总结应当去除重复内容并突出核心要点

### 需求 4: 置信度评估机制

**用户故事:** 作为用户，我希望系统能够评估综合总结与各单笔记总结的置信度，以便确保总结质量。

#### 验收标准

1. 当综合总结生成后，系统应当计算它与每份单笔记总结的置信度分数
2. 置信度分数应当在0-100%范围内
3. 系统应当使用文本相似度算法来计算置信度
4. 置信度计算结果应当被记录和返回

### 需求 5: 智能总结选择和修正

**用户故事:** 作为用户，我希望系统能够根据置信度智能选择最佳总结方案，并在必要时进行修正。

#### 验收标准

1. 当置信度大于60%时，系统应当采用综合总结作为最终结果
2. 当置信度小于等于60%时，系统应当将综合总结与低置信度的单笔记总结进行比对修正
3. 修正后应当重新计算置信度
4. 系统应当尝试找出笔记间的相关性来改善总结质量

### 需求 6: API端点实现

**用户故事:** 作为开发者，我希望通过标准的REST API来使用笔记总结功能，以便集成到其他应用中。

#### 验收标准

1. 系统应当提供 `/api/v2/notes/summarize` POST端点来接收笔记
2. API应当接收JSON格式的请求，包含笔记数组
3. API应当返回JSON格式的处理结果，包含标题、主题、正文（Markdown格式）和置信度信息
4. 正文应当支持MathJax公式渲染，内容应当简短精炼
5. API应当提供适当的错误处理和状态码
6. API文档应当使用中文描述

### 需求 7: 任务状态跟踪

**用户故事:** 作为用户，我希望能够查询笔记总结任务的处理状态，以便了解处理进度。

#### 验收标准

1. 系统应当提供 `/api/v2/notes/summarize/{task_id}` GET端点来查询任务状态
2. 当任务正在处理时，应当返回"处理中"状态
3. 当任务完成时，应当返回完整的总结结果
4. 当任务失败时，应当返回错误信息和失败原因
### 需求 8:
 测试页面

**用户故事:** 作为开发者，我希望有一个简单的测试页面来验证笔记总结功能，以便快速测试和调试。

#### 验收标准

1. 系统应当提供一个简单的HTML测试页面
2. 测试页面应当允许用户输入多份笔记文本
3. 测试页面应当能够调用API并显示返回的JSON结果
4. 测试页面应当能够渲染Markdown格式的正文内容
5. 测试页面应当支持MathJax公式显示
6. 测试页面应当显示处理状态和错误信息